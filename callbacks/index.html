
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../pythonic-interface/">
      
      
        <link rel="next" href="../cli-interface/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Callbacks - PyHELICS</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#implementing-helics-callbacks-in-python" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="PyHELICS" class="md-header__button md-logo" aria-label="PyHELICS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PyHELICS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Callbacks
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/GMLC-TDC/pyhelics/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="PyHELICS" class="md-nav__button md-logo" aria-label="PyHELICS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    PyHELICS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/GMLC-TDC/pyhelics/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../pythonic-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pythonic API
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Callbacks
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Callbacks
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#define-user-data" class="md-nav__link">
    <span class="md-ellipsis">
      Define User Data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#define-the-callback" class="md-nav__link">
    <span class="md-ellipsis">
      Define the Callback
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#register-the-callback" class="md-nav__link">
    <span class="md-ellipsis">
      Register the Callback
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#filter-federate-code" class="md-nav__link">
    <span class="md-ellipsis">
      Filter Federate Code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-response-code" class="md-nav__link">
    <span class="md-ellipsis">
      Query Response Code
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLI Interface
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../web-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Web Interface (experimental)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../migration-helics2-helics3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Migration v2 -> v3
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#define-user-data" class="md-nav__link">
    <span class="md-ellipsis">
      Define User Data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#define-the-callback" class="md-nav__link">
    <span class="md-ellipsis">
      Define the Callback
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#register-the-callback" class="md-nav__link">
    <span class="md-ellipsis">
      Register the Callback
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#filter-federate-code" class="md-nav__link">
    <span class="md-ellipsis">
      Filter Federate Code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-response-code" class="md-nav__link">
    <span class="md-ellipsis">
      Query Response Code
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="implementing-helics-callbacks-in-python">Implementing HELICS Callbacks in Python<a class="headerlink" href="#implementing-helics-callbacks-in-python" title="Permanent link">&para;</a></h1>
<p>There are several HELICS functionalities that allow for the definition of custom behavior through the use of custom callback functions. Two specific examples are the definition of the filter behavior when implementing a filter federate and the other is the response to a custom query. In both cases custom code needs to be written to define behavior when HELICS needs to perform a specific action (filter a message, respond to a query). There are a few steps to implement callbacks in PyHELICS</p>
<h2 id="define-user-data">Define User Data<a class="headerlink" href="#define-user-data" title="Permanent link">&para;</a></h2>
<p>The callback function generally exists outside the scope of other code and thus, if the functionality defined in the callback needs data from, say, the federate, that data has to be carried into the callback through a custom class generically called &ldquo;user data&rdquo;. This user data is defined as a class that is instantiated and filled as a part of federate operation.  </p>
<div class="highlight"><pre><span></span><code><span class="c1"># Store what ever data you&#39;d like. </span>
<span class="c1"># A reference to this object is passed to the filter callback. </span>
<span class="c1"># You don&#39;t need to use this if you don&#39;t want to.</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UserData</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iteration_count</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pi</span> <span class="o">=</span> <span class="mf">3.14</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="mf">2.718</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interation_count</span> <span class="o">=</span> <span class="n">iteration_count</span>
</code></pre></div>
<h2 id="define-the-callback">Define the Callback<a class="headerlink" href="#define-the-callback" title="Permanent link">&para;</a></h2>
<p>This is where the real C-to-Python magic happens, using the &ldquo;cffi&rdquo; library. As the HELICS library being used is C-based, there are several things that look weird in the Python world that we have to do to properly hook into that library. The biggest of these is adding a Python decorator to the callback in the form of a string that contains the C signature of the callback being implemented. For example:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Filter callback</span>
<span class="nd">@h</span><span class="o">.</span><span class="n">ffi</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;void logger(HelicsMessage, void* userData)&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">filter_callback</span><span class="p">(</span><span class="n">mess</span><span class="p">,</span> <span class="n">userData</span><span class="p">):</span>
    <span class="c1"># Filter operation code here</span>

<span class="c1"># Query callback</span>
<span class="nd">@h</span><span class="o">.</span><span class="n">ffi</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;void query(const char *query, int querySize, HelicsQueryBuffer buffer, void *user_data)&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">query_callback</span><span class="p">(</span><span class="n">query_ptr</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">query_buffer_ptr</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
    <span class="n">query_str</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">ffi</span><span class="o">.</span><span class="n">string</span><span class="p">(</span><span class="n">query_ptr</span><span class="p">,</span><span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="n">query_buffer</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">HelicsQueryBuffer</span><span class="p">(</span><span class="n">query_buffer_ptr</span><span class="p">)</span>
    <span class="c1"># Query operation code here</span>
</code></pre></div>
<p>In the case of the query callback, you can see there are two other bits that need to be added in.</p>
<p>1 - The query string is passed in as a C pointer. If you&rsquo;ve only worked in Python, you might wonder what a &ldquo;pointer&rdquo; is. So does Python; the &ldquo;cffi&rdquo; library is used to translate the data the pointer is referencing into something Python recognizes as a string. 
  2 - The query response that will be created by the callback function must be put into a pre-constructed databuffer that is passed in when the callback is made (&ldquo;HelicsQueryBuffer buffer&rdquo; in the above C signature). HELICS will read this buffer to get the response of the callback. Again, pointers are involved so we use the &ldquo;cffi&rdquo; library to make them something Python can deal with.</p>
<h2 id="register-the-callback">Register the Callback<a class="headerlink" href="#register-the-callback" title="Permanent link">&para;</a></h2>
<p>Last step, with the callback defined we need to &ldquo;register&rdquo; it so that HELICS knows which function to call when its time to execute the callback. This is done as part of setting up your federate and should be done as early as possible so that the federate is able to respond to any callbacks that come in early in the life of a federate.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Filter callback federate code</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="o">...</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsFederateRegisterFilter</span><span class="p">(</span><span class="n">fFed</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">HELICS_FILTER_TYPE_CUSTOM</span><span class="p">,</span> <span class="s2">&quot;filter1&quot;</span><span class="p">)</span>
    <span class="n">userdata</span> <span class="o">=</span> <span class="n">UserData</span><span class="p">(</span><span class="n">iteration_count</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">user_data_handle</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">ffi</span><span class="o">.</span><span class="n">new_handle</span><span class="p">(</span><span class="n">userdata</span><span class="p">)</span>
    <span class="n">h</span><span class="o">.</span><span class="n">helicsFilterSetCustomCallback</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">filter_callback</span><span class="p">,</span> <span class="n">user_data_handle</span><span class="p">)</span>


<span class="c1"># Query callback federate code</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="o">...</span>
    <span class="n">fed</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsCreateValueFederateFromConfig</span><span class="p">(</span><span class="s2">&quot;math_fed.json&quot;</span><span class="p">)</span>
    <span class="n">user_data</span> <span class="o">=</span> <span class="n">UserData</span><span class="p">(</span><span class="n">iteration_count</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">user_data_handle</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">ffi</span><span class="o">.</span><span class="n">new_handle</span><span class="p">(</span><span class="n">user_data</span><span class="p">)</span>
    <span class="n">h</span><span class="o">.</span><span class="n">helicsFederateSetQueryCallback</span><span class="p">(</span><span class="n">fed</span><span class="p">,</span> <span class="n">query_callback</span><span class="p">,</span> <span class="n">user_data_handle</span><span class="p">)</span>
</code></pre></div>
<p>In both cases, the user data is defined, a &ldquo;handle&rdquo; to the user data is created, and the callback functions are registered using specific HELICS APIs.</p>
<h2 id="complete-examples">Complete Examples<a class="headerlink" href="#complete-examples" title="Permanent link">&para;</a></h2>
<p>Here are the full code for completeness sake. As of this writing, there is not a running example for the filter callback but there is one for the <a href="https://github.com/GMLC-TDC/HELICS-Examples/blob/53bece298f9be952002e2f9201f24922fabc73b4/user_guide_examples/advanced/advanced_connector/interface_creation/Charger.py">query callback</a> in the <a href="https://github.com/GMLC-TDC/HELICS-Examples">HELICS Examples repository</a>.</p>
<h3 id="filter-federate-code">Filter Federate Code<a class="headerlink" href="#filter-federate-code" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UserData</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iteration_count</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pi</span> <span class="o">=</span> <span class="mf">3.14</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="mf">2.718</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interation_count</span> <span class="o">=</span> <span class="n">iteration_count</span>

<span class="nd">@h</span><span class="o">.</span><span class="n">ffi</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;void logger(HelicsMessage, void* userData)&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">filter_callback</span><span class="p">(</span><span class="n">mess</span><span class="p">,</span> <span class="n">userData</span><span class="p">):</span>
    <span class="c1"># Filter operation code here</span>


<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">fed</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsCreateValueFederateFromConfig</span><span class="p">(</span><span class="s2">&quot;math_fed.json&quot;</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsFederateRegisterFilter</span><span class="p">(</span><span class="n">fed</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">HELICS_FILTER_TYPE_CUSTOM</span><span class="p">,</span> <span class="s2">&quot;filter1&quot;</span><span class="p">)</span>
    <span class="n">userdata</span> <span class="o">=</span> <span class="n">UserData</span><span class="p">(</span><span class="n">iteration_count</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">user_data_handle</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">ffi</span><span class="o">.</span><span class="n">new_handle</span><span class="p">(</span><span class="n">userdata</span><span class="p">)</span>
    <span class="n">h</span><span class="o">.</span><span class="n">helicsFilterSetCustomCallback</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">filter_callback</span><span class="p">,</span> <span class="n">user_data_handle</span><span class="p">)</span>
</code></pre></div>
<h3 id="query-response-code">Query Response Code<a class="headerlink" href="#query-response-code" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UserData</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iteration_count</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pi</span> <span class="o">=</span> <span class="mf">3.14</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="mf">2.718</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interation_count</span> <span class="o">=</span> <span class="n">iteration_count</span>

<span class="nd">@h</span><span class="o">.</span><span class="n">ffi</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;void query(const char *query, int querySize, HelicsQueryBuffer buffer, void *user_data)&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">query_callback</span><span class="p">(</span><span class="n">query_ptr</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">query_buffer_ptr</span><span class="p">,</span> <span class="n">user_data</span><span class="p">):</span>
    <span class="n">query_str</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">ffi</span><span class="o">.</span><span class="n">string</span><span class="p">(</span><span class="n">query_ptr</span><span class="p">,</span><span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="n">query_buffer</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">HelicsQueryBuffer</span><span class="p">(</span><span class="n">query_buffer_ptr</span><span class="p">)</span>
    <span class="c1"># Query operation code here</span>


<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">fed</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsCreateValueFederateFromConfig</span><span class="p">(</span><span class="s2">&quot;math_fed.json&quot;</span><span class="p">)</span>
    <span class="n">user_data</span> <span class="o">=</span> <span class="n">UserData</span><span class="p">(</span><span class="n">iteration_count</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">user_data_handle</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">ffi</span><span class="o">.</span><span class="n">new_handle</span><span class="p">(</span><span class="n">user_data</span><span class="p">)</span>
    <span class="n">h</span><span class="o">.</span><span class="n">helicsFederateSetQueryCallback</span><span class="p">(</span><span class="n">fed</span><span class="p">,</span> <span class="n">query_callback</span><span class="p">,</span> <span class="n">user_data_handle</span><span class="p">)</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>